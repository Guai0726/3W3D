<html>

<head>
    <meta charset="utf-8">
    <title>hw1</title>
</head>

<body>
    <a href="../index.html" style="text-decoration: none">
        <p style="text-align: center; font-size: 44px; font-weight: bold; color:rgb(20, 170, 120); margin: 2vh;">
            HW1 Xmas Lights
        </p>
    </a>
    <img src="tree.jpg"style="display: block;position:absolute;left: 0;right: 0; margin: 0 auto;height: 85vh; width: 85vh;">
    <div id="bkgd"style="display: block;position:absolute;left: 0;right: 0; margin: 0 auto;height: 85vh; width: 85vh;"> 
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript">
            var powerOn = true;

            $('#power').click(function () {
                powerOn = !powerOn;

                if (powerOn === true) {  // false--> true
                    lamps.forEach(function (item) { item.startBlink(); });
                }
            });

            class Lamp {

                constructor(name) {
                    this.name = name + Lamp.id++;
                    this.myStatus = false;

                    let el = document.createElement('div');
                    el.id = this.name;
                    let bkgd = document.getElementById('bkgd');
                    bkgd.appendChild(el);
                    this.hue = Math.random() * 360;

                    // styles
                    el.setAttribute("style", `background-color: hsl(${this.hue}, 90%, 50%); width:5%;height:5%;border-radius:50%`);
                    this.left = Math.random();
                    this.top = Math.random();
                    el.style.position = "absolute";
                    let abc = Math.random();
                    el.style.left = this.left * 75 + '%';
                    el.style.top = 10 + this.top * 75 + '%';
                }

                toggle() {
                    this.myStatus = !this.myStatus;

                    if (powerOn) {
                        setTimeout(() => { this.toggle(); }, abcd);
                    }

                    if (this.myStatus === true&& $('#power').text() === 'ON') {
                        $('#' + this.name).css('backgroundColor', `hsl(${this.hue},90%,80%)`);

                    } else {
                        $('#' + this.name).css('backgroundColor', `hsl(${this.hue},90%,24%)`);

                    }
                }

                startBlink() {
                    var that = this;
                       
                    /*    setInterval(function() {
                          that.toggle();
                        }, 500);*/
                    
                    setTimeout(() => { this.toggle(); }, 0);

                    //setInterval (that.toggle, 500);   // somehow, it does not work
                }
            }


            Lamp.id = 0; // class variable
            lamps = [];
            abcd = 500;
            for (let i = 0; i < 10; i++) {
                let ll = new Lamp('light');
                lamps.push(ll);
            }

            lamps.forEach(function (ll) { ll.startBlink(); });

        </script>
        </div>
        <div style="position: absolute; margin: 0 auto; height: 85vh; min-height:38px; width: 30vh; min-width: auto; left: 118vh; right: 0;">
            <div>
                <p style="font-size: 24px; margin: 12px auto;">開關 : 
                    <button id="power" style="background-color:rgb(200, 200, 200);" onclick="power()">ON</button>
                </p>
            </div>
            <div>
                <p style="font-size: 24px; margin: 12px auto;">同步 : 
                    <button id="sync" style="background-color:rgb(200, 200, 200);" onclick="sync()">ON</button>
                </p>
            </div>
            <div>
                <p style="font-size: 24px; margin: 12px auto;">閃爍週期 : 
                    <button id="dutyCycleA" style="background-color:rgb(100, 100, 100);" onclick="dutyCycle()">0.5s</button>
                    <button id="dutyCycleB" style="background-color:rgb(200, 200, 200);" onclick="dutyCycle()">1~2s</button>
                </p>
            </div>
            <script>
                function power() {
                    if ($('#power').text() === 'ON') {
                        $('#power').text('OFF');
                        $('#power').css({'background-color': 'rgb(100, 100, 100)'});
                    } else {
                        $('#power').text('ON');
                        $('#power').css({'background-color': 'rgb(200, 200, 200)'});
                    }
                    lights.forEach(element => {
                        element.flick = false;
                        element.toggleLight();
                    });
                }
                    /*我不會寫同步QQ*/
    
                function dutyCycle() {
                    if ($('#dutyCycleA').css('background-color') === 'rgb(100, 100, 100)') {
                        $('#dutyCycleA').css({'background-color': 'rgb(200, 200, 200)'});
                        $('#dutyCycleB').css({'background-color': 'rgb(100, 100, 100)'});
                        abcd = (1 + Math.random()) * 1000;
                    } else {
                        $('#dutyCycleA').css({'background-color': 'rgb(100, 100, 100)'});
                        $('#dutyCycleB').css({'background-color': 'rgb(200, 200, 200)'});
                        abcd = 500;
                    }
                    
                }
            </script>
</body>

</html>